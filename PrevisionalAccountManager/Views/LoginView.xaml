<UserControl x:Class="PrevisionalAccountManager.Views.LoginView"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
             xmlns:vm="clr-namespace:PrevisionalAccountManager.ViewModels"
             mc:Ignorable="d"
             d:DesignHeight="800" d:DesignWidth="800"
             d:DataContext="{d:DesignInstance Type=vm:LoginViewModel, IsDesignTimeCreatable=True}">
    <Grid>
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto" />
            <RowDefinition Height="*" />
            <RowDefinition Height="*" />
        </Grid.RowDefinitions>

        <!-- Theme Selector at the top -->
        <StackPanel Grid.Row="0" Orientation="Vertical" HorizontalAlignment="Right" Margin="20,15">
          
            <TextBlock Text="Theme: " VerticalAlignment="Center" Margin="0,0,8,0"
                       Style="{DynamicResource FieldLabelStyle}" />
            <ComboBox ItemsSource="{Binding AvailableThemes}"
                      SelectedItem="{Binding SelectedTheme}"
                      Width="120" Height="30">
            </ComboBox>
            <Button Content="Backup Database"
                Command="{Binding BackupDatabaseCommand}"
                Style="{DynamicResource PrimaryButtonStyle}"
                ToolTip="Allow exporting database" />
            <Button Content="Import Database"
                    Command="{Binding ImportDatabaseCommand}"
                    Style="{DynamicResource PrimaryButtonStyle}"
                    ToolTip="Allow Importing database" />
        </StackPanel>

        <!-- Main Content -->
        <StackPanel Grid.Row="1" HorizontalAlignment="Center" VerticalAlignment="Center" Width="350">
            <StackPanel.InputBindings>
                <KeyBinding Key="Enter" Command="{Binding PrimaryCommand}" />
            </StackPanel.InputBindings>

            <!-- Title -->
            <TextBlock Style="{DynamicResource TitleStyle}" Text="{Binding FormTitle}" />

            <!-- Username -->
            <TextBlock Style="{DynamicResource FieldLabelStyle}" Text="Username:" />
            <TextBox
                Text="{Binding Username, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"
                IsEnabled="{Binding IsLoading, Converter={StaticResource InverseBooleanConverter}}" />

            <!-- Password -->
            <TextBlock Text="Password:" Style="{DynamicResource FieldLabelStyle}" />
            <Grid Margin="0,0,0,10">
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="*" />
                    <ColumnDefinition Width="Auto" />
                </Grid.ColumnDefinitions>

                <!-- Hidden PasswordBox -->
                <PasswordBox x:Name="PasswordBox" Grid.Column="0"
                             IsEnabled="{Binding IsLoading, Converter={StaticResource InverseBooleanConverter}}"
                             Visibility="{Binding IsPasswordVisible, Converter={StaticResource InverseBooleanToVisibilityConverter}}" />

                <!-- Visible TextBox -->
                <TextBox x:Name="PasswordTextBox" Grid.Column="0"
                         Text="{Binding Password, UpdateSourceTrigger=PropertyChanged}"
                         IsEnabled="{Binding IsLoading, Converter={StaticResource InverseBooleanConverter}}"
                         Visibility="{Binding IsPasswordVisible, Converter={StaticResource BooleanToVisibilityConverter}}" />

                <!-- Toggle Button -->
                <Button Grid.Column="1"
                        Command="{Binding TogglePasswordVisibilityCommand}"
                        Style="{DynamicResource EyeToggleButtonStyle}"
                        ToolTip="Toggle password visibility">
                    <TextBlock Text="{Binding IsPasswordVisible, Converter={StaticResource BooleanToVisibilityIconConverter}}" />
                </Button>
            </Grid>

            <!-- Confirm Password (only visible in create account mode) -->
            <TextBlock Text="Confirm Password:" Style="{DynamicResource FieldLabelStyle}"
                       Visibility="{Binding IsCreateAccountMode, Converter={StaticResource BooleanToVisibilityConverter}}" />
            <Grid Margin="0,0,0,15"
                  Visibility="{Binding IsCreateAccountMode, Converter={StaticResource BooleanToVisibilityConverter}}">
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="*" />
                    <ColumnDefinition Width="Auto" />
                </Grid.ColumnDefinitions>

                <!-- Hidden PasswordBox -->
                <PasswordBox x:Name="ConfirmPasswordBox" Grid.Column="0"
                             IsEnabled="{Binding IsLoading, Converter={StaticResource InverseBooleanConverter}}"
                             Visibility="{Binding IsConfirmPasswordVisible, Converter={StaticResource InverseBooleanToVisibilityConverter}}" />

                <!-- Visible TextBox -->
                <TextBox x:Name="ConfirmPasswordTextBox" Grid.Column="0"
                         Text="{Binding ConfirmPassword, UpdateSourceTrigger=PropertyChanged}"
                         IsEnabled="{Binding IsLoading, Converter={StaticResource InverseBooleanConverter}}"
                         Visibility="{Binding IsConfirmPasswordVisible, Converter={StaticResource BooleanToVisibilityConverter}}" />

                <!-- Toggle Button -->
                <Button Grid.Column="1"
                        Command="{Binding ToggleConfirmPasswordVisibilityCommand}"
                        Style="{DynamicResource EyeToggleButtonStyle}"
                        ToolTip="Toggle password visibility">
                    <TextBlock Text="{Binding IsConfirmPasswordVisible, Converter={StaticResource BooleanToVisibilityIconConverter}}" />
                </Button>
            </Grid>

            <!-- Primary Action Button -->

            <Button
                Content="{Binding PrimaryButtonText}"
                Command="{Binding PrimaryCommand}"
                Style="{DynamicResource PrimaryButtonStyle}" />

            <!-- Loading indicator -->
            <ProgressBar Style="{DynamicResource LoadingProgressBarStyle}"
                         Visibility="{Binding IsLoading, Converter={StaticResource BooleanToVisibilityConverter}}" />

            <!-- Toggle Mode Button -->
            <Button Content="{Binding ToggleButtonText}" Command="{Binding ToggleModeCommand}"
                    Style="{DynamicResource SecondaryButtonStyle}"
                    IsEnabled="{Binding IsLoading, Converter={StaticResource InverseBooleanConverter}}" />

            <!-- Success Message -->
            <TextBlock Text="{Binding SuccessMessage}" Style="{DynamicResource SuccessTextStyle}"
                       Visibility="{Binding HasSuccess, Converter={StaticResource BooleanToVisibilityConverter}}" />

            <!-- Error Message -->
            <TextBlock Text="{Binding ErrorMessage}" Style="{DynamicResource ErrorTextStyle}"
                       Visibility="{Binding HasError, Converter={StaticResource BooleanToVisibilityConverter}}" />

            <!-- Password Requirements -->
            <TextBlock Style="{DynamicResource HelperTextStyle}"
                       Visibility="{Binding IsCreateAccountMode, Converter={StaticResource BooleanToVisibilityConverter}}">
                <Run Text="Password Requirements:" FontWeight="Bold" />
                <LineBreak />
                <Run Text="• At least 6 characters long" />
                <LineBreak />
                <Run Text="• Username must be at least 3 characters long" />
            </TextBlock>
        </StackPanel>
    </Grid>
</UserControl>